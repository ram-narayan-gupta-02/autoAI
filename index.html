<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegalAI Workspace | Enterprise Pro Model</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #f1f5f9;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }

        .glass-sidebar { background: #0f172a; }
        .active-tab { background: #2563eb !important; color: white !important; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3); }

        .tab-content { display: none; animation: slideIn 0.3s ease-out; }
        .tab-content.active { display: block; }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .ai-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }

        .loader-ring {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Modal & Toast styles */
        .modal-overlay { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); }
        #toast-container { z-index: 9999; }
    </style>
</head>
<body class="h-screen overflow-hidden flex flex-col lg:flex-row">

    <!-- Toast Notification System -->
    <div id="toast-container" class="fixed top-6 right-6 flex flex-col gap-3"></div>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-40 hidden lg:hidden" onclick="toggleSidebar()"></div>

    <!-- Sidebar Navigation -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 w-72 glass-sidebar text-slate-400 flex flex-col z-50 transition-transform duration-300 -translate-x-full lg:translate-x-0 lg:relative">
        <div class="p-8 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-xl shadow-lg">
                    <i data-lucide="scale" class="text-white w-6 h-6"></i>
                </div>
                <span class="text-xl font-black tracking-tighter text-white">LegalAI <span class="text-blue-500 text-[10px] tracking-widest block uppercase">Pro Workspace</span></span>
            </div>
            <button onclick="toggleSidebar()" class="lg:hidden text-slate-400 hover:text-white"><i data-lucide="x"></i></button>
        </div>

        <nav class="flex-1 px-4 space-y-1.5 overflow-y-auto custom-scrollbar">
            <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-4 mt-6">Main Command</p>
            <button onclick="switchTab('dashboard')" id="btn-dashboard" class="nav-btn w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all hover:bg-slate-800 active-tab">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i><span class="text-sm font-bold">Dashboard</span>
            </button>
            <button onclick="switchTab('cases')" id="btn-cases" class="nav-btn w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all hover:bg-slate-800">
                <i data-lucide="briefcase" class="w-5 h-5"></i><span class="text-sm font-bold">Case Files</span>
            </button>
            <button onclick="switchTab('drafting')" id="btn-drafting" class="nav-btn w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all hover:bg-slate-800">
                <i data-lucide="zap" class="w-5 h-5"></i><span class="text-sm font-bold">AI Drafting</span>
            </button>
            <button onclick="switchTab('research')" id="btn-research" class="nav-btn w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all hover:bg-slate-800">
                <i data-lucide="book-open" class="w-5 h-5"></i><span class="text-sm font-bold">Research Engine</span>
            </button>
            <button onclick="switchTab('vault')" id="btn-vault" class="nav-btn w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all hover:bg-slate-800">
                <i data-lucide="database" class="w-5 h-5"></i><span class="text-sm font-bold">Firm Vault</span>
            </button>
            
            <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-3 mt-8">Organization</p>
            <button onclick="switchTab('settings')" id="btn-settings" class="nav-btn w-full flex items-center gap-3 px-4 py-3.5 rounded-xl transition-all hover:bg-slate-800">
                <i data-lucide="settings" class="w-5 h-5"></i><span class="text-sm font-bold">Configurations</span>
            </button>
        </nav>

        <div class="p-6 mt-auto border-t border-slate-800 bg-slate-900/50 flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-600 to-indigo-600 flex items-center justify-center font-bold text-white shadow-inner">RS</div>
            <div class="flex-1 min-w-0">
                <p class="text-xs font-black text-white truncate">Adv. Rajesh Sharma</p>
                <p class="text-[9px] text-slate-500 font-bold uppercase tracking-tighter">Managing Partner</p>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col min-w-0 bg-[#F8FAFC]">
        <!-- Global Header -->
        <header class="h-20 bg-white border-b border-slate-200 flex items-center justify-between px-6 lg:px-10 shrink-0 z-10">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="lg:hidden p-2 text-slate-600 hover:bg-slate-100 rounded-lg"><i data-lucide="menu"></i></button>
                <h2 id="currentTabLabel" class="text-lg font-black text-slate-800 uppercase tracking-widest hidden md:block">Analytics Console</h2>
            </div>
            <div class="flex items-center gap-4">
                <div id="statusIndicator" class="hidden xl:flex items-center gap-2 bg-emerald-50 border border-emerald-100 px-3 py-1.5 rounded-full">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full ai-pulse"></span>
                    <span class="text-[9px] font-black text-emerald-600 uppercase tracking-widest">LegalAI: Ready</span>
                </div>
                <button onclick="openNewCaseModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl text-xs font-black uppercase tracking-widest shadow-xl shadow-blue-500/20 transition-all flex items-center gap-2">
                    <i data-lucide="plus" class="w-4 h-4"></i> Initialize Case
                </button>
            </div>
        </header>

        <!-- Main Workspace -->
        <div id="mainWorkspace" class="flex-1 overflow-y-auto p-6 lg:p-10 custom-scrollbar">
            
            <!-- Dashboard Screen -->
            <div id="dashboard" class="tab-content active space-y-10">
                <div class="flex flex-col md:flex-row justify-between items-end gap-4">
                    <div>
                        <h1 class="text-3xl font-black text-slate-900 tracking-tighter">Welcome back, Adv. Sharma</h1>
                        <p class="text-slate-500 font-medium">Here's the summary of your firm's AI-driven productivity today.</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6" id="dashboardStats">
                    <!-- Stats injected by JS -->
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
                    <div class="xl:col-span-2 bg-white rounded-[2.5rem] border border-slate-200 p-8 shadow-sm">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em]">Priority Case Stream</h3>
                            <button onclick="switchTab('cases')" class="text-blue-600 text-xs font-black hover:underline uppercase tracking-widest">Full Directory</button>
                        </div>
                        <div id="priorityCasesList" class="space-y-4">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                    <div class="bg-[#0F172A] rounded-[2.5rem] p-10 text-white shadow-2xl relative overflow-hidden group">
                        <div class="relative z-10 flex flex-col justify-between h-full">
                            <div>
                                <h3 class="text-xl font-black uppercase tracking-tight mb-4 text-blue-500">Legal Intelligence</h3>
                                <p class="text-slate-400 text-sm mb-8 leading-relaxed">Instantly draft petitions or research case laws using firm's historic intelligence.</p>
                                <div class="bg-slate-800/80 p-4 rounded-2xl border border-slate-700 text-[10px] font-mono text-slate-500 mb-8 italic">
                                    "Analyze Section 138 Negotiable Instruments Act for recovery grounds..."
                                </div>
                            </div>
                            <button onclick="switchTab('drafting')" class="w-full py-4 bg-blue-600 hover:bg-blue-700 rounded-2xl font-black text-xs uppercase tracking-widest shadow-lg shadow-blue-500/20 transition-all">
                                Open Drafting Lab
                            </button>
                        </div>
                        <div class="absolute top-0 right-0 p-4 opacity-5 rotate-12 group-hover:scale-110 transition-transform">
                            <i data-lucide="scale" style="width: 200px; height: 200px;"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Case Management Screen -->
            <div id="cases" class="tab-content space-y-6">
                <!-- Case List -->
                <div id="caseListSection" class="bg-white rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden">
                    <div class="p-8 border-b border-slate-100 flex flex-col md:flex-row md:items-center justify-between gap-6">
                        <div>
                            <h3 class="text-xl font-black text-slate-900 tracking-tighter">Case Intelligence</h3>
                            <p class="text-slate-500 text-xs mt-1 font-medium italic">Active matter directory & lifecycle management.</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="bg-slate-50 p-1.5 rounded-2xl border border-slate-200 flex">
                                <button onclick="filterCases('Active')" id="filter-active" class="case-filter px-5 py-2 bg-white rounded-xl shadow-sm text-xs font-black text-blue-600">Active</button>
                                <button onclick="filterCases('Closed')" id="filter-closed" class="case-filter px-5 py-2 rounded-xl text-xs font-black text-slate-400">Closed</button>
                            </div>
                            <button class="p-3 bg-slate-50 border border-slate-200 rounded-xl"><i data-lucide="filter" class="w-5 h-5"></i></button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50/50 text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100">
                                <tr>
                                    <th class="px-8 py-6">Case Identification</th>
                                    <th class="px-8 py-6">Court Forum</th>
                                    <th class="px-8 py-6">Lead Counsel</th>
                                    <th class="px-8 py-6">Current Stage</th>
                                    <th class="px-8 py-6 text-right">Progress</th>
                                </tr>
                            </thead>
                            <tbody id="caseTableBody" class="divide-y divide-slate-100">
                                <!-- Injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Case Details -->
                <div id="caseDetailSection" class="hidden space-y-8 pb-20">
                    <button onclick="showCaseList()" class="flex items-center gap-2 text-slate-500 hover:text-slate-900 font-black text-[10px] uppercase tracking-widest transition-all">
                        <i data-lucide="chevron-left" class="w-4 h-4"></i> Return to Directory
                    </button>
                    <div id="caseDetailContent">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </div>

            <!-- AI Drafting Screen -->
            <div id="drafting" class="tab-content h-full">
                <div class="grid grid-cols-1 xl:grid-cols-12 gap-8 h-full min-h-[600px] pb-10">
                    <div class="xl:col-span-4 flex flex-col gap-6">
                        <div class="bg-white p-10 rounded-[2.5rem] border border-slate-200 shadow-sm flex-1 flex flex-col space-y-8">
                            <div>
                                <h3 class="text-xl font-black text-slate-900 uppercase tracking-tight flex items-center gap-3">
                                    <i data-lucide="zap" class="text-blue-600"></i> Drafting Lab
                                </h3>
                                <p class="text-slate-500 text-[10px] mt-1 font-bold uppercase tracking-widest">Logic-Aware Document synthesis</p>
                            </div>
                            <div class="space-y-6 flex-1 flex flex-col">
                                <div class="space-y-2">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Draft Prototype</label>
                                    <select id="draftType" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-bold focus:ring-4 focus:ring-blue-500/10 outline-none appearance-none">
                                        <option>Legal Notice</option>
                                        <option>Writ Petition (Civil)</option>
                                        <option>Bail Application</option>
                                        <option>Service Agreement</option>
                                    </select>
                                </div>
                                <div class="space-y-2 flex-1 flex flex-col">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest px-1">Case Facts & Claims</label>
                                    <textarea id="draftPrompt" class="flex-1 w-full p-6 bg-slate-50 border border-slate-200 rounded-[2rem] text-sm font-medium leading-relaxed focus:bg-white focus:ring-4 focus:ring-blue-500/10 transition-all outline-none resize-none" placeholder="Enter party names, incident details, and laws invoked..."></textarea>
                                </div>
                                <button id="generateBtn" onclick="executeDraftAI()" class="w-full py-5 bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded-[1.5rem] font-black text-xs uppercase tracking-[0.2em] shadow-2xl shadow-blue-500/30 active:scale-95 transition-all flex items-center justify-center gap-3">
                                    <i data-lucide="zap" class="w-5 h-5"></i> Execute Synthesis
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="xl:col-span-8 flex flex-col relative">
                        <div class="bg-[#0f172a] rounded-[2.5rem] border border-slate-800 shadow-2xl flex-1 flex flex-col overflow-hidden relative">
                            <div class="p-6 bg-slate-800/80 border-b border-slate-700 flex justify-between items-center px-10">
                                <div class="flex gap-2">
                                    <div class="w-2.5 h-2.5 rounded-full bg-red-500/40"></div>
                                    <div class="w-2.5 h-2.5 rounded-full bg-amber-500/40"></div>
                                    <div class="w-2.5 h-2.5 rounded-full bg-emerald-500/40"></div>
                                </div>
                                <span class="text-[10px] text-slate-500 font-black uppercase tracking-[0.3em]">AI Document Preview</span>
                                <div class="flex gap-4">
                                    <button onclick="mockDownload('Draft')" class="text-slate-400 hover:text-white" title="Download"><i data-lucide="download" class="w-5 h-5"></i></button>
                                    <button onclick="mockShare('Draft')" class="text-slate-400 hover:text-white" title="Share"><i data-lucide="share-2" class="w-5 h-5"></i></button>
                                </div>
                            </div>
                            <div id="draftOutput" class="flex-1 p-12 lg:p-20 overflow-y-auto custom-scrollbar font-serif text-slate-200 text-lg leading-[2.2] selection:bg-blue-600/40">
                                <div class="h-full flex flex-col items-center justify-center opacity-10 text-slate-600 text-center gap-8">
                                    <i data-lucide="file-text" style="width: 100px; height: 100px;"></i>
                                    <p class="text-2xl font-black uppercase tracking-tighter">Command Awaiting Execution</p>
                                </div>
                            </div>
                        </div>
                        <div id="draftLoader" class="absolute inset-0 bg-[#0f172a]/90 backdrop-blur-md z-20 flex flex-col items-center justify-center gap-6 hidden rounded-[2.5rem]">
                            <div class="loader-ring"></div>
                            <div class="text-center">
                                <p class="text-lg font-black text-slate-100 animate-pulse tracking-tight uppercase">Applying Indian Statutes</p>
                                <p class="text-[9px] text-slate-500 mt-2 font-bold uppercase tracking-[0.3em]">Constructing Legal Logic...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Research Engine Screen -->
            <div id="research" class="tab-content max-w-5xl mx-auto space-y-10 pb-20">
                <div class="bg-white p-12 rounded-[2.5rem] border border-slate-200 shadow-sm text-center relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-6">
                            <i data-lucide="search" class="w-8 h-8"></i>
                        </div>
                        <h1 class="text-4xl font-black text-slate-900 tracking-tighter">AI Research Engine</h1>
                        <p class="text-slate-500 text-sm mt-3 max-w-lg mx-auto leading-relaxed font-medium font-italic">Research Precedents, Statutes, and Issue-wise Breakdowns using Firm & Public Intelligence.</p>
                        
                        <div class="mt-12 relative group max-w-3xl mx-auto">
                            <i data-lucide="search" class="absolute left-6 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-500 transition-colors"></i>
                            <input id="researchInput" type="text" placeholder="E.g., Legal grounds for quashing Section 498A FIR after settlement?" class="w-full pl-16 pr-40 py-6 bg-slate-50 border border-slate-200 rounded-[2.5rem] text-lg font-medium focus:outline-none focus:ring-8 focus:ring-blue-500/5 focus:bg-white transition-all outline-none">
                            <button onclick="executeResearchAI()" id="researchBtn" class="absolute right-3 top-1/2 -translate-y-1/2 bg-slate-900 text-white px-8 py-3.5 rounded-[1.5rem] font-black text-[10px] uppercase tracking-widest shadow-xl active:scale-95 transition-all">
                                Analyze Query
                            </button>
                        </div>
                        <div class="mt-8 flex flex-wrap justify-center gap-3">
                            <span onclick="setResearchTag('Quashing Section 482 CrPC property dispute grounds')" class="px-5 py-2 bg-slate-50 border border-slate-200 rounded-full text-[10px] font-black text-slate-500 cursor-pointer hover:bg-blue-600 hover:text-white hover:border-blue-600 transition-all uppercase tracking-widest">Criminal Law</span>
                            <span onclick="setResearchTag('GST exemption for non-profit educational trusts')" class="px-5 py-2 bg-slate-50 border border-slate-200 rounded-full text-[10px] font-black text-slate-500 cursor-pointer hover:bg-blue-600 hover:text-white hover:border-blue-600 transition-all uppercase tracking-widest">Taxation</span>
                            <span onclick="setResearchTag('Adverse possession claim requirements for agricultural land')" class="px-5 py-2 bg-slate-50 border border-slate-200 rounded-full text-[10px] font-black text-slate-500 cursor-pointer hover:bg-blue-600 hover:text-white hover:border-blue-600 transition-all uppercase tracking-widest">Civil Matters</span>
                        </div>
                    </div>
                </div>

                <div id="researchResult" class="hidden animate-in slide-in-from-top-10 duration-700"></div>
            </div>

            <!-- Knowledge Vault Screen -->
            <div id="vault" class="tab-content space-y-10 pb-20">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-6">
                    <div>
                        <h2 class="text-3xl font-black text-slate-900 tracking-tighter leading-none">Firm Knowledge Vault</h2>
                        <p class="text-slate-500 text-sm mt-3 font-medium">Institutional memory indexed via Semantic Search.</p>
                    </div>
                    <div class="flex gap-4">
                        <div class="relative w-80">
                            <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4"></i>
                            <input id="vaultSearch" type="text" oninput="filterVault()" placeholder="Search internal records..." class="w-full pl-12 pr-4 py-3 bg-white border border-slate-200 rounded-2xl text-sm focus:outline-none focus:ring-4 focus:ring-blue-500/5 transition-all">
                        </div>
                        <button onclick="simulateIndexing()" class="px-6 py-3 bg-slate-900 text-white rounded-2xl font-black text-[10px] uppercase tracking-widest flex items-center gap-2 active:scale-95 transition-all shadow-xl">
                            <i data-lucide="folder-plus" class="w-4 h-4"></i> Index New
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="vaultGrid"></div>

                <div class="bg-white rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden">
                    <div class="p-8 border-b border-slate-100 flex items-center justify-between">
                        <h3 class="text-[10px] font-black uppercase tracking-widest text-slate-400">Contextually Synchronized Documents</h3>
                        <div class="flex items-center gap-2"><span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span><span class="text-[9px] font-black text-emerald-600 uppercase tracking-widest">Live Sync</span></div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100">
                                <tr>
                                    <th class="px-8 py-5">File Discovery</th>
                                    <th class="px-8 py-5">AI Relevance</th>
                                    <th class="px-8 py-5">Date Indexed</th>
                                    <th class="px-8 py-5 text-right">Owner</th>
                                </tr>
                            </thead>
                            <tbody id="vaultTableBody" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Configurations Screen -->
            <div id="settings" class="tab-content max-w-5xl mx-auto space-y-10 pb-20">
                <h1 class="text-4xl font-black text-slate-900 tracking-tighter">Configurations</h1>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
                    <div class="lg:col-span-4 space-y-2">
                        <button class="settings-btn w-full text-left px-6 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest bg-blue-600 text-white shadow-xl shadow-blue-500/30">Team Access Control</button>
                        <button class="settings-btn w-full text-left px-6 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:bg-white border border-transparent">AI Engine Orchestration</button>
                        <button class="settings-btn w-full text-left px-6 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-500 hover:bg-white border border-transparent">Security & Logs</button>
                    </div>
                    <div class="lg:col-span-8 space-y-8">
                        <div class="bg-white rounded-[2.5rem] border border-slate-200 shadow-sm overflow-hidden">
                            <div class="p-8 border-b border-slate-100 flex items-center justify-between">
                                <h3 class="text-[10px] font-black uppercase tracking-widest text-slate-400">Team Hierarchy (RBAC)</h3>
                                <button onclick="invitePartner()" class="bg-slate-900 text-white px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest active:scale-95 transition-all">+ Invite Partner</button>
                            </div>
                            <div id="teamTableContainer" class="p-0 overflow-x-auto"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Modals -->
    <div id="newCaseModal" class="fixed inset-0 z-[100] modal-overlay flex items-center justify-center hidden px-6">
        <div class="bg-white rounded-[2.5rem] w-full max-w-lg shadow-2xl p-10 animate-in zoom-in-95 duration-300">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-2xl font-black text-slate-900 tracking-tighter">Initialize New Case</h3>
                <button onclick="closeNewCaseModal()" class="text-slate-400 hover:text-slate-900"><i data-lucide="x"></i></button>
            </div>
            <div class="space-y-6">
                <div class="space-y-2">
                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Case Title / Matter Name</label>
                    <input id="modalTitle" type="text" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm font-bold focus:ring-4 focus:ring-blue-500/10 outline-none" placeholder="e.g. State vs. John Doe">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Case Type</label>
                        <select id="modalType" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none">
                            <option>Criminal</option><option>Civil</option><option>Corporate</option><option>IPR</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Court</label>
                        <input id="modalCourt" type="text" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-xs font-bold outline-none" placeholder="High Court, Delhi">
                    </div>
                </div>
                <button onclick="addNewCase()" class="w-full py-5 bg-blue-600 text-white rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-blue-500/20 active:scale-95 transition-all">Create Case File</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. STATE ---
        const apiKey = "AIzaSyCuKeVM49bVsF4yjQm16-j-kewhyNyDc0s";
        const modelName = "gemini-2.5-flash-preview-09-2025";

        const state = {
            activeTab: 'dashboard',
            caseFilter: 'Active',
            cases: [
                { id: 'L-24-001', title: 'HDFC Bank vs. Global Tradings', type: 'Commercial', status: 'Active', priority: 'High', client: 'HDFC Ltd', next: 'Jan 25, 2024', progress: 75, court: 'DRT-1 Delhi', counsel: ['Adv. Rajesh'], timeline: [{t: 'Filing', d: 'Oct 12', s: 'done'}, {t: 'Arguments', d: 'Jan 25', s: 'up'}] },
                { id: 'L-24-002', title: 'State vs. Vikram Rajput', type: 'Criminal', status: 'Active', priority: 'Urgent', client: 'Vikram Singh', next: 'Jan 22, 2024', progress: 20, court: 'Sessions Court Saket', counsel: ['Adv. Sneha'], timeline: [{t: 'Bail App', d: 'Jan 05', s: 'done'}, {t: 'Police Reply', d: 'Jan 22', s: 'up'}] },
                { id: 'L-23-452', title: 'Mehta Property Dispute', type: 'Civil', status: 'Closed', priority: 'Medium', client: 'S. Mehta', next: 'Closed', progress: 100, court: 'Gurugram District', counsel: ['Adv. Rajesh'], timeline: [{t: 'Judgment', d: 'Dec 15', s: 'done'}] }
            ],
            team: [
                { id: 1, name: 'Adv. Rajesh Sharma', role: 'Managing Partner', email: 'rajesh@legalai.pro', privilege: 'Super Admin' },
                { id: 2, name: 'Adv. Sneha Varma', role: 'Associate Partner', email: 'sneha@legalai.pro', privilege: 'Write Access' }
            ],
            vaultFiles: [
                { name: 'Mehta_Notice_2022.pdf', rel: '98%', owner: 'Adv. Rajesh', date: 'Jan 15, 2024' },
                { name: 'NDA_Global_V2.docx', rel: '85%', owner: 'Adv. Sneha', date: 'Jan 10, 2024' }
            ]
        };

        // --- 2. CORE UTILS ---
        function showToast(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-slate-900' : 'bg-red-600';
            toast.className = `${bgColor} text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 animate-in slide-in-from-right-10 duration-300 font-bold text-xs uppercase tracking-widest`;
            toast.innerHTML = `<i data-lucide="${type === 'success' ? 'check-circle' : 'alert-circle'}" class="w-4 h-4"></i> ${msg}`;
            container.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => { toast.classList.add('animate-out', 'fade-out'); setTimeout(() => toast.remove(), 500); }, 3000);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
            document.getElementById('sidebarOverlay').classList.toggle('hidden');
        }

        function switchTab(tabId) {
            state.activeTab = tabId;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById(`btn-${tabId}`).classList.add('active-tab');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            document.getElementById('currentTabLabel').innerText = tabId.toUpperCase();
            if (window.innerWidth < 1024) toggleSidebar();
            renderTab(tabId);
        }

        // --- 3. DYNAMIC CLICKABLE ACTIONS ---
        function filterCases(filter) {
            state.caseFilter = filter;
            document.querySelectorAll('.case-filter').forEach(btn => {
                btn.classList.remove('bg-white', 'shadow-sm', 'text-blue-600');
                btn.classList.add('text-slate-400');
            });
            const activeBtn = document.getElementById(`filter-${filter.toLowerCase()}`);
            activeBtn.classList.add('bg-white', 'shadow-sm', 'text-blue-600');
            activeBtn.classList.remove('text-slate-400');
            renderCaseList();
        }

        function openNewCaseModal() { document.getElementById('newCaseModal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('newCaseModal').classList.add('hidden'); }
        function closeNewCaseModal() { closeModal(); }

        function addNewCase() {
            const title = document.getElementById('modalTitle').value;
            const type = document.getElementById('modalType').value;
            const court = document.getElementById('modalCourt').value;
            if(!title) { showToast("Title is required", "error"); return; }
            
            const newCase = {
                id: 'L-24-' + Math.floor(Math.random() * 900 + 100),
                title, type, court, status: 'Active', priority: 'Medium', client: 'New Client',
                next: 'TBD', progress: 5, counsel: ['Adv. Rajesh'],
                timeline: [{t: 'Initialized', d: 'Today', s: 'done'}]
            };
            state.cases.unshift(newCase);
            closeModal();
            showToast("New Case File Created Successfully");
            switchTab('cases');
        }

        function invitePartner() {
            const name = prompt("Enter Partner Name:");
            if(!name) return;
            state.team.push({ id: Date.now(), name, role: 'Associate', email: name.toLowerCase().replace(' ', '') + '@legalai.pro', privilege: 'Write Access' });
            renderSettings();
            showToast(`Invitation sent to ${name}`);
        }

        function removeMember(id) {
            state.team = state.team.filter(m => m.id !== id);
            renderSettings();
            showToast("Team Access Revoked");
        }

        function setResearchTag(val) {
            document.getElementById('researchInput').value = val;
            showToast("Query Prompt Loaded");
        }

        function simulateIndexing() {
            showToast("Indexing selected repository...");
            setTimeout(() => showToast("AI Semantic Indexing Complete"), 2000);
        }

        function mockDownload(type) { showToast(`${type} downloaded as PDF`); }
        function mockShare(type) { showToast(`${type} shared via secure link`); }

        // --- 4. RENDERERS ---
        function renderTab(tabId) {
            if (tabId === 'dashboard') renderDashboard();
            if (tabId === 'cases') renderCaseList();
            if (tabId === 'vault') renderVault();
            if (tabId === 'settings') renderSettings();
            lucide.createIcons();
        }

        function renderDashboard() {
            document.getElementById('dashboardStats').innerHTML = [
                { l: "Active Files", v: state.cases.length, i: 'gavel', c: 'blue' },
                { l: "AI Gain", v: "82%", i: 'zap', c: 'emerald' },
                { l: "Storage", v: "4.2 TB", i: 'database', c: 'amber' },
                { l: "Velocity", v: "+12%", i: 'activity', c: 'indigo' }
            ].map(s => `<div class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm"><div class="w-12 h-12 rounded-xl bg-${s.c}-50 text-${s.c}-600 flex items-center justify-center mb-4"><i data-lucide="${s.i}"></i></div><p class="text-2xl font-black text-slate-900">${s.v}</p><p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${s.l}</p></div>`).join('');

            document.getElementById('priorityCasesList').innerHTML = state.cases.slice(0, 3).map(c => `
                <div onclick="openCaseDetail('${c.id}')" class="group p-5 rounded-2xl bg-slate-50 hover:bg-white border border-transparent hover:border-blue-100 transition-all cursor-pointer flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-white border border-slate-200 flex items-center justify-center font-black text-slate-400 group-hover:bg-blue-600 group-hover:text-white transition-all">${c.id.split('-').pop()}</div>
                        <div><p class="font-bold text-slate-900 text-sm">${c.title}</p><p class="text-[9px] text-slate-400 uppercase font-black">${c.court}</p></div>
                    </div>
                    <i data-lucide="chevron-right" class="text-slate-300 w-5 h-5"></i>
                </div>`).join('');
        }

        function renderCaseList() {
            document.getElementById('caseListSection').classList.remove('hidden');
            document.getElementById('caseDetailSection').classList.add('hidden');
            const filtered = state.cases.filter(c => c.status === state.caseFilter);
            document.getElementById('caseTableBody').innerHTML = filtered.map(c => `
                <tr onclick="openCaseDetail('${c.id}')" class="group hover:bg-slate-50/80 cursor-pointer transition-colors">
                    <td class="px-8 py-6 flex items-center gap-4"><div class="w-10 h-10 rounded-lg bg-white border border-slate-200 flex items-center justify-center font-black text-slate-400">${c.id.split('-').pop()}</div><div><p class="font-bold text-slate-900 text-sm">${c.title}</p><p class="text-[9px] text-slate-400 font-black uppercase">${c.client}</p></div></td>
                    <td class="px-8 py-6 text-xs font-bold text-slate-500 uppercase">${c.court}</td>
                    <td class="px-8 py-6 flex -space-x-2">${c.counsel.map(n => `<div class="w-8 h-8 rounded-full bg-slate-200 border-2 border-white flex items-center justify-center text-[8px] font-black">${n.charAt(5)}</div>`).join('')}</td>
                    <td class="px-8 py-6"><span class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-[9px] font-black uppercase tracking-widest">${c.status}</span></td>
                    <td class="px-8 py-6 text-right font-black text-blue-600 text-xs">${c.progress}%</td>
                </tr>`).join('') || `<tr><td colspan="5" class="p-20 text-center text-slate-400 font-bold uppercase tracking-widest">No ${state.caseFilter} cases found</td></tr>`;
        }

        function openCaseDetail(id) {
            const c = state.cases.find(item => item.id === id);
            document.getElementById('caseListSection').classList.add('hidden');
            document.getElementById('caseDetailSection').classList.remove('hidden');
            document.getElementById('caseDetailContent').innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-8 bg-white p-10 rounded-[3rem] border border-slate-200 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-10"><span class="px-4 py-2 bg-blue-600 text-white rounded-full text-[10px] font-black uppercase tracking-widest">${c.status}</span></div>
                        <h1 class="text-4xl font-black text-slate-900 tracking-tight">${c.title}</h1>
                        <p class="text-xs font-black text-blue-600 mt-2 uppercase tracking-widest">${c.id} â€¢ Privileged Record</p>
                        <div class="mt-12 h-3 bg-slate-100 rounded-full border border-slate-200 overflow-hidden"><div class="h-full bg-blue-600" style="width: ${c.progress}%"></div></div>
                        <div class="mt-12 space-y-8 relative before:absolute before:left-4 before:top-2 before:bottom-2 before:w-0.5 before:bg-slate-100">
                            ${c.timeline.map(t => `<div class="relative pl-12"><div class="absolute left-0 top-0.5 w-8 h-8 rounded-full border-4 border-white shadow-md flex items-center justify-center ${t.s==='done'?'bg-blue-600 text-white':'bg-slate-200 text-slate-500'}"><i data-lucide="check" class="w-4 h-4"></i></div><p class="text-sm font-black">${t.t}</p><p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${t.d}</p></div>`).join('')}
                        </div>
                    </div>
                    <div class="lg:col-span-4 space-y-8">
                        <div class="bg-[#0f172a] p-10 rounded-[2.5rem] text-white shadow-2xl"><h4 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-8">Case Council</h4><div class="space-y-4">${c.counsel.map(n => `<div class="flex items-center gap-4 p-4 bg-slate-800/60 rounded-2xl border border-slate-700"><div class="w-10 h-10 rounded-xl bg-blue-600 flex items-center justify-center font-bold text-xs">RS</div><span class="text-sm font-bold">${n}</span></div>`).join('')}</div></div>
                        <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm flex flex-col h-[300px]"><h4 class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Firm Strategy Hub</h4><textarea id="caseNote" class="flex-1 bg-slate-50 p-6 rounded-3xl text-sm leading-relaxed outline-none" placeholder="Draft strategy notes..."></textarea><button onclick="saveCaseNote()" class="mt-4 w-full py-4 bg-slate-900 text-white rounded-xl text-[10px] font-black uppercase tracking-widest">Commit Note</button></div>
                    </div>
                </div>`;
            lucide.createIcons();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderVault() {
            const vaultItems = [
                { name: 'Civil Writs', count: 142, last: '2h ago' }, { name: 'Criminal Bail', count: 89, last: '1d ago' },
                { name: 'Corporate MSAs', count: 210, last: '3d ago' }, { name: 'Arbitration', count: 34, last: '1w ago' }
            ];
            document.getElementById('vaultGrid').innerHTML = vaultItems.map(v => `<div onclick="showToast('Browsing ${v.name} Folders')" class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm hover:shadow-md hover:border-blue-200 cursor-pointer transition-all group"><div class="p-4 bg-blue-50 text-blue-600 rounded-2xl w-fit mb-6 group-hover:bg-blue-600 group-hover:text-white transition-all"><i data-lucide="folder-open"></i></div><h4 class="font-bold text-slate-800 text-sm">${v.name}</h4><p class="text-[10px] text-slate-400 font-black uppercase mt-1 tracking-widest">${v.count} Records</p></div>`).join('');
            document.getElementById('vaultTableBody').innerHTML = state.vaultFiles.map(f => `<tr onclick="showToast('Previewing ${f.name}')" class="hover:bg-slate-50 transition-colors cursor-pointer"><td class="px-8 py-6 flex items-center gap-3"><i data-lucide="file-text" class="text-blue-500 w-4 h-4"></i><span class="text-sm font-bold text-slate-800">${f.name}</span></td><td class="px-8 py-6"><span class="px-3 py-1 bg-blue-50 text-blue-600 border border-blue-100 rounded-full text-[9px] font-black uppercase tracking-widest">${f.rel} Match</span></td><td class="px-8 py-6 text-xs font-bold text-slate-400 uppercase tracking-widest">${f.date}</td><td class="px-8 py-6 text-right text-xs font-bold text-slate-500 uppercase">${f.owner}</td></tr>`).join('');
        }

        function renderSettings() {
            document.getElementById('teamTableContainer').innerHTML = `<table class="w-full text-left"><thead class="bg-slate-50 text-[10px] font-black text-slate-400 uppercase tracking-widest border-b border-slate-100"><tr><th class="px-8 py-5">Counsel Details</th><th class="px-8 py-5">Role</th><th class="px-8 py-5 text-right">Actions</th></tr></thead><tbody class="divide-y divide-slate-100">${state.team.map(m => `<tr class="text-sm"><td class="px-8 py-6"><div><p class="font-bold text-slate-900">${m.name}</p><p class="text-[10px] text-slate-400 uppercase font-bold">${m.email}</p></div></td><td class="px-8 py-6 text-[10px] font-black uppercase text-slate-500">${m.role}</td><td class="px-8 py-6 text-right"><button onclick="removeMember(${m.id})" class="text-red-500 hover:text-red-700 transition-colors"><i data-lucide="trash-2" class="w-4 h-4 ml-auto"></i></button></td></tr>`).join('')}</tbody></table>`;
            lucide.createIcons();
        }

        // --- 5. AI ENGINE ---
        async function fetchAI(prompt, system) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
            const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: system }] } }) });
            if (!response.ok) throw new Error("API Failure");
            return response.json();
        }

        async function executeDraftAI() {
            const prompt = document.getElementById('draftPrompt').value;
            if(!prompt) { showToast("Provide case facts", "error"); return; }
            document.getElementById('draftLoader').classList.remove('hidden');
            try {
                const data = await fetchAI(prompt, "Act as an elite legal architect. Draft a formal document with legal terminology (Indian Law).");
                document.getElementById('draftOutput').innerHTML = `<div class="animate-in fade-in slide-in-from-bottom-6 duration-1000 whitespace-pre-wrap">${data.candidates[0].content.parts[0].text}</div>`;
                showToast("Document Synthesized Successfully");
            } catch (err) { showToast("AI Engine Error", "error"); } finally { document.getElementById('draftLoader').classList.add('hidden'); }
        }

        async function executeResearchAI() {
            const query = document.getElementById('researchInput').value;
            if(!query) { showToast("Input research query", "error"); return; }
            const btn = document.getElementById('researchBtn');
            btn.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-4 h-4"></i> Analyzing...`;
            btn.disabled = true;
            lucide.createIcons();
            try {
                const data = await fetchAI(query, "Act as a legal researcher. Provide 3 major precedents and relevant statutes.");
                const res = document.getElementById('researchResult');
                res.classList.remove('hidden');
                res.innerHTML = `<div class="bg-[#0f172a] p-12 rounded-[3rem] text-slate-300 shadow-2xl overflow-hidden group"><h3 class="text-[10px] font-black text-blue-500 uppercase tracking-widest mb-8 italic">AI Intelligence Summary</h3><div class="font-serif text-lg leading-loose whitespace-pre-wrap">${data.candidates[0].content.parts[0].text}</div></div>`;
                res.scrollIntoView({ behavior: 'smooth' });
                showToast("Research Analysis Complete");
            } catch (err) { showToast("Research Hub Unreachable", "error"); } finally { btn.innerHTML = "Analyze Query"; btn.disabled = false; lucide.createIcons(); }
        }

        function showCaseList() { document.getElementById('caseListSection').classList.remove('hidden'); document.getElementById('caseDetailSection').classList.add('hidden'); }
        function saveCaseNote() { showToast("Strategy committed to Firm Knowledge Base"); }

        window.onload = () => { switchTab('dashboard'); };

    </script>
</body>
</html>
